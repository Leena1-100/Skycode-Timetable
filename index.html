<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>스카이코드 학생 시간표</title>
    <style>
        body {
            font-family: 'Malgun Gothic', sans-serif;
            background-color: #f4f7f6; margin: 0; padding: 20px;
            display: flex; justify-content: center; align-items: center; flex-direction: column; color: #333;
        }
        .container {
            width: 100%; max-width: 1200px; background-color: white; padding: 30px;
            border-radius: 10px; box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        h1 { 
            text-align: center; margin-bottom: 20px; 
        }
        h1 img {
            height: 50px;
        }
        
        #main-input-form {
            display: none;
        }
        #toggle-form-btn {
            position: fixed; bottom: 30px; right: 30px; z-index: 100;
            background-color: #007bff; color: white; border: none; border-radius: 50px;
            padding: 15px 25px; font-size: 16px; font-weight: bold; cursor: pointer;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            transition: all 0.2s ease-in-out;
        }
        #toggle-form-btn:hover {
            background-color: #0056b3;
            transform: translateY(-2px);
        }

        .input-form {
            border: 1px solid #e0e0e0; padding: 20px; border-radius: 8px;
            background-color: #fcfcfc; margin-bottom: 30px;
        }
        .form-row { display: grid; grid-template-columns: 2fr 1fr; gap: 20px; margin-bottom: 20px; }
        .input-group { display: flex; flex-direction: column; }
        .subject-entry-row {
            display: grid; grid-template-columns: 1fr 1fr 1fr 1fr 40px;
            gap: 10px; align-items: end; margin-bottom: 10px;
        }
        label { margin-bottom: 6px; font-weight: bold; color: #34495e; font-size: 13px; }
        input[type="text"], input[type="time"], select {
            padding: 9px; border: 1px solid #ddd; border-radius: 5px; font-size: 15px;
        }
        .add-subject-btn, .remove-subject-btn {
            background-color: #6c757d; color: white; border: none; border-radius: 5px;
            cursor: pointer; font-size: 14px; padding: 9px;
        }
        .remove-subject-btn { background-color: #dc3545; }
        #submit-btn {
            background-color: #28a745; color: white; width: 100%; padding: 12px;
            font-size: 16px; font-weight: bold; border: none;
            border-radius: 5px; cursor: pointer; margin-top: 10px;
        }
        .tab-container { display: flex; border-bottom: 2px solid #dee2e6; margin-bottom: 1px;}
        .tab-button {
            padding: 10px 20px; border: none; background-color: transparent;
            cursor: pointer; font-size: 16px; border-radius: 5px 5px 0 0;
            margin-bottom: -2px; border: 2px solid transparent;
        }
        .tab-button.active {
            background-color: white; border-color: #dee2e6 #dee2e6 white;
            font-weight: bold; color: #007bff;
        }
        .tab-content { display: none; }
        .tab-content.active { display: block; border: 2px solid #dee2e6; border-top: none; padding: 10px;}
        .schedule-grid { display: grid; border-radius: 8px; overflow-x: auto; }
        .grid-header, .time-cell, .student-col-header, .schedule-cell {
            border: 1px solid #e0e0e0; text-align: center; box-sizing: border-box;
        }
        .grid-header, .time-cell { grid-column: 1; }
        .student-col-header { 
            background-color: #ecf0f1; font-weight: bold; padding: 10px; min-width: 150px;
            cursor: pointer; position: relative; z-index: 1;
        }
        .time-cell { font-weight: bold; font-size: 14px; padding: 5px 0;}
        .schedule-cell { position: relative; min-height: 40px; }
        .sticky-col {
            position: -webkit-sticky; position: sticky; left: 0; z-index: 2; 
            background-color: #f8f8f8;
        }
        .sticky-col.grid-header { background-color: #ecf0f1; }
        .subject-block {
            position: absolute; top: 0; left: 2px; right: 2px; bottom: 0;
            font-size: 12px; color: #333; overflow: hidden;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            text-align: center; cursor: pointer; padding: 4px;
        }
        .subject-block b { font-size: 14px; margin-bottom: 2px; }
        .subject-block .memo-text { font-size: 11px; opacity: 0.9; line-height: 1.2; }
        .is-first-block { border-top-left-radius: 6px; border-top-right-radius: 6px; }
        .is-last-block { border-bottom-left-radius: 6px; border-bottom-right-radius: 6px; }
        .delete-icon {
            position: absolute; top: 4px; right: 4px; color: #c0392b;
            font-size: 14px; cursor: pointer; z-index: 10;
            background: rgba(255,255,255,0.7); border-radius: 50%;
            width: 14px; height: 14px; line-height: 14px; text-align:center; display: none;
        }
        .subject-block.is-first-block:hover .delete-icon { display: block; }
        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background-color: rgba(0,0,0,0.6); z-index: 100;
            display: none; justify-content: center; align-items: center;
        }
        .modal-content {
            background-color: white; padding: 20px; border-radius: 10px;
            width: 90%; max-width: 900px; max-height: 90vh;
            display: flex; flex-direction: column;
        }
        .modal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
        .modal-close-btn { font-size: 28px; font-weight: bold; cursor: pointer; }
        #modal-schedule-container { overflow-y: auto; }
        #modal-schedule-container .grid-header,
        #modal-schedule-container .time-cell {
            background-color: #f8f8f8; font-weight: bold; padding: 8px 5px;
            border: 1px solid #e0e0e0;
        }
        #modal-schedule-container .day-header {
            background-color: #ecf0f1; font-weight: bold; padding: 10px;
            border: 1px solid #e0e0e0;
        }
        #modal-schedule-container .modal-schedule-cell {
            border: 1px solid #e0e0e0; min-height: 40px;
            position: relative; 
        }
        #modal-weekday-grid { display: grid; grid-template-columns: 80px repeat(5, 1fr); }
        #modal-saturday-grid { display: grid; grid-template-columns: 80px 1fr; }

        /* --- ✨ 여기가 핵심 변경사항입니다 (1/4) --- */
        #print-btn {
            background-color: #17a2b8; color: white; border: none; border-radius: 5px;
            padding: 8px 15px; font-size: 14px; cursor: pointer; margin-left: auto;
        }
        @media print {
            body * { visibility: hidden; }
            #printable-area, #printable-area * { visibility: visible; }
            #printable-area {
                position: absolute; left: 0; top: 0; width: 100%; height: 100%;
                font-size: 8pt; /* 글자 크기 축소 */
            }
            #printable-area h2, #printable-area h3 { font-size: 12pt; }
            #printable-area .subject-block b { font-size: 9pt; }
            #printable-area .memo-text { font-size: 7pt; }
            #printable-area .time-cell, #printable-area .day-header { font-size: 8pt; padding: 4px 2px; }
            #printable-area .modal-schedule-cell { min-height: 25px; }
            @page { size: A4; margin: 20mm; }
            .printable-section {
                width: 45%; /* A4의 약 1/4 너비 */
                height: 45%; /* A4의 약 1/4 높이 */
                page-break-inside: avoid;
            }
        }
        /* --- ✨ 변경사항 끝 --- */
        
        .subject-수학 { background-color: #b3e0ff; } .subject-영어 { background-color: #ffe0b3; }
        .subject-과학 { background-color: #b3ffb3; } .subject-국어 { background-color: #ffb3b3; }
        .subject-사회 { background-color: #e0b3ff; } .subject-기타 { background-color: #f0f0f0; }
    </style>
</head>
<body>
    <div class="container">
        <h1>
            <img src="https://raw.githubusercontent.com/Leena1-100/Skycode-Timetable/main/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202025-08-28%20012041.png" alt="스카이코드 로고">
        </h1>
        <div id="main-input-form" class="input-form"></div>
        <div class="tab-container"></div>
        <div id="월" class="tab-content active"><div class="schedule-grid" id="grid-월"></div></div>
        <div id="화" class="tab-content"><div class="schedule-grid" id="grid-화"></div></div>
        <div id="수" class="tab-content"><div class="schedule-grid" id="grid-수"></div></div>
        <div id="목" class="tab-content"><div class="schedule-grid" id="grid-목"></div></div>
        <div id="금" class="tab-content"><div class="schedule-grid" id="grid-금"></div></div>
        <div id="토" class="tab-content"><div class="schedule-grid" id="grid-토"></div></div>
    </div>
    <template id="subject-entry-template"></template>

    <div id="student-modal" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modal-student-name"></h2>
                <div>
                    <button id="print-btn" onclick="printSchedule()">인쇄하기</button>
                    <span class="modal-close-btn" onclick="closeModal()" style="margin-left: 15px;">&times;</span>
                </div>
            </div>
            <div id="printable-area">
                <div id="modal-schedule-container">
                     <div class="printable-section">
                         <h3>평일 시간표 (15:00 ~ 22:00)</h3>
                         <div class="schedule-grid" id="modal-weekday-grid"></div>
                     </div>
                     <div class="printable-section" style="margin-top: 20px;">
                         <h3>토요일 시간표 (10:00 ~ 17:30)</h3>
                         <div class="schedule-grid" id="modal-saturday-grid"></div>
                     </div>
                </div>
            </div>
        </div>
    </div>

    <button id="toggle-form-btn" onclick="toggleInputForm()">학생 정보 입력 / 수정</button>

    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    <script>
        const firebaseConfig = {
          apiKey: "AIzaSyABj6I5mmD3WN9cu8B0sIB2ZO0INgwBuuI",
          authDomain: "skycode-timetable.firebaseapp.com",
          projectId: "skycode-timetable",
          storageBucket: "skycode-timetable.appspot.com",
          messagingSenderId: "66485090384",
          appId: "1:66485090384:web:8759a841a04a7f3704b955"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        let scheduleData = { '월': {}, '화': {}, '수': {}, '목': {}, '금': {}, '토': {} };
        const weekdayStartHour = 15; const weekdayEndHour = 22;
        const saturdayStartHour = 10; const saturdayEndHour = 18;
        const days = ['월', '화', '수', '목', '금', '토'];
        const subjectColors = { '수학': 'subject-수학', '영어': 'subject-영어', '과학': 'subject-과학', '국어': 'subject-국어', '사회': 'subject-사회', '기타': 'subject-기타' };
        const timeToMinutes = t => { if(!t) return 0; const [h, m] = t.split(':').map(Number); return h * 60 + m; };
        const minutesToTime = m => { const h = Math.floor(m / 60); const min = m % 60; return `${String(h).padStart(2, '0')}:${String(min).padStart(2, '0')}`; };
        function toggleInputForm() { /* 이전과 동일 */ }
        function openDay(evt, dayName) { /* 이전과 동일 */ }
        function renderAll() { days.forEach(day => renderDay(day)); }
        function renderDay(day) { /* 이전과 동일 */ }
        async function updateSchedule() { /* 이전과 동일 */ }
        async function deleteSchedule(studentName, day, event) { /* 이전과 동일 */ }
        function styleStudentBlocks(studentName, day, isModal = false) { /* 이전과 동일 */ }
        function loadStudentDataToForm(studentName, day) { /* 이전과 동일 */ }
        function validateTimeInput(input) { /* 이전과 동일 */ }
        function addSubjectField() { /* 이전과 동일 */ }
        function openStudentWeekView(studentName) { /* 이전과 동일 */ }
        function closeModal() { document.getElementById('student-modal').style.display = 'none'; }
        
        // --- ✨ 여기가 핵심 변경사항입니다 (4/4) ---
        function printSchedule() {
            window.print();
        }
        
        window.onload = () => {
            days.forEach(day => {
                db.collection('schedules').doc(day).onSnapshot((doc) => {
                    scheduleData[day] = doc.exists ? doc.data() : {};
                    renderDay(day);
                });
            });
            const modal = document.getElementById('student-modal');
            modal.onclick = function(event) { if (event.target == modal) { closeModal(); } }
        };

        // (이전 코드의 모든 함수들은 여기에 그대로 포함되어야 합니다)
        // ... toggleInputForm, openDay, renderDay 등 모든 함수 ...
    </script>
</body>
</html>
